namespace = starborn

# Terminus Systems Species Variety
country_event = {
	id = starborn_me.1
	hide_window = yes
	
	trigger = {
		has_origin = origin_terminus_omega
	}

	is_triggered_only = yes
	
	immediate = {
		capital_scope = {
			create_species = {
				class="MassEffectBIO"
				portrait="vorcha"
				name="Vorcha"
				plural="Vorcha"
				adjective="Vorcha"
				name_list="vorcha"
				homeworld = this
				traits = { 
					trait="me_trait_vorcha_primitive"
					trait="me_trait_vorcha_adaptation"
				}
				sapient = yes
				is_mod = no
				immortal = no
			}
			create_species = {
				class="MassEffectBIO"
				portrait="batarian"
				name="Batarian"
				plural="Batarians"
				adjective="Batarians"
				name_list="batarian"
				homeworld = this
				traits = { 
					trait="trait_decadent"
					trait="trait_quarrelsome"
					trait="me_trait_four_eyes"
					trait="trait_conformists"
				}
				sapient = yes
				is_mod = no
				immortal = no
			}
			create_species = {
				class="MassEffectBIO"
				portrait="krogan"
				name="Krogan"
				plural="Krogan"
				adjective="Krogan"
				name_list="krogan"
				homeworld = this
				traits = { 
					trait="trait_survivor"
					trait="me_trait_genophage"
					trait="me_trait_violent_by_nature"
					trait="me_trait_krogan_physiology"
				}
				sapient = yes
				is_mod = no
				immortal = no
			}
			create_species = {
				class="MassEffectBIO"
				portrait="quarian"
				name="Quarian"
				plural="Quarians"
				adjective="Quarian"
				homeworld = this
				name_list="quarian_names"
				traits = { 
					trait="me_trait_ship_bound"
					trait="me_trait_keelahsalai"
					trait="me_trait_dextro_immunity"
				}
				sapient = yes
				is_mod = no
				immortal = no
			}
			create_species = {
				class="MassEffectBIO"
				portrait="turian"
				name="Turian"
				plural="Turians"
				adjective="Turian"
				name_list="turian_names"
				homeworld = this
				traits = { 
					trait="me_trait_born_to_serve"
					trait="me_trait_dextro_immunity"
				}
				sapient = yes
				is_mod = no
				immortal = no
			}
			create_species = {
				class="MassEffectBIO"
				portrait="human"
				name="Human"
				plural="Humans"
				adjective="Human"
				name_list="alliance_names"
				homeworld = this
				traits = { 
					trait="trait_wasteful"
					trait="me_trait_humans_ambitious"
				}
				sapient = yes
				is_mod = no
				immortal = no
			}
		}
		capital_scope = {
            while = {
                random_pop = {
                    limit = {
                        has_trait = me_trait_asari_life
                    }
                    kill_pop = yes
                }
                count = 25
            }
        }
		capital_scope = {
			while = {
				count = 5
				create_pop = {
					species = "Human"
				}
			}
		}
		capital_scope = {
			while = {
				count = 7
				create_pop = {
					species = "Krogan"
				}
			}
		}
		capital_scope = {
			while = {
				count = 8
				create_pop = {
					species = "Vorcha"
				}
			}
		}
		capital_scope = {
			while = {
				count = 9
				create_pop = {
					species = "Batarian"
				}
			}
		}
		capital_scope = {
			while = {
				count = 6
				create_pop = {
					species = "Turian"
				}
			}
		}
		capital_scope = {
			while = {
				count = 3
				create_pop = {
					species = "Quarian"
				}
			}
		}
	}
}

#2. tried to cheat enlarging habitat
country_event = {
        id = starborn.2    
        title = "starborn.2.name"
        desc = "starborn.2.desc"
        show_sound = event_mystic_reveal
        picture = GFX_evt_colony_settlement
        is_triggered_only = yes
        location = FromFromFrom.Planet

        option = {
                name = "starborn.2.option.a"
        }
}



#6. hab enlargement failed because you lacked resources
country_event = {
        id = starborn.6    
        title = "starborn.6.name"
        desc = "starborn.6.desc"
        show_sound = event_mystic_reveal
        picture = GFX_evt_colony_settlement
        is_triggered_only = yes
        location = FromFromFrom.Planet

        option = {
                name = "starborn.6.option.a"
        }
}


#10 put refund modifer on smaller hab alloys cost
planet_event = {
        id = starborn.10
        hide_window = yes
        is_triggered_only = yes

        trigger = {
                owner = {
                        has_starborn = yes
                }
                is_planet_class = pc_habitat
        }

        immediate = {
                if = {
                        limit = {
                                has_retile = yes
                        }
                        switch = {
                                trigger = planet_size
                                3 = {  add_deposit = d_starborn_refund_size_3 }
                                4 = {  add_deposit = d_starborn_refund_size_3 }
                                5 = {  add_deposit = d_starborn_refund_size_4 }
                                6 = {  add_deposit = d_starborn_refund_size_4 }
                        }
                }
                else = { 
                        switch = {
                                trigger = planet_size
                                3 = {  add_deposit = d_starborn_refund_size_3 }
                                4 = {  add_deposit = d_starborn_refund_size_4 }
                        }
                }
        }
}


# Habitat Complex Complete Notification
country_event = {
        id = "starborn.20"
        title = "starborn.20.name"
        desc = "starborn.20.desc"
        picture = GFX_evt_colony_settlement
        is_triggered_only = yes
        location = FromFromFrom.Planet

        option = {
                name = EXCELLENT
        }
}


# 30. Remove whole planetary farming when colonised
# Making the window appear is much easier as a follow on country event
planet_event = {
        id = starborn.30
        is_triggered_only = yes
        hide_window = yes

        trigger = {
                exists = owner
                owner = {
                        any_planet_within_border = {
                                has_planet_flag = habitat_of@root
                                has_planet_flag = starborn_farming_habitat
                        }
                }
        }

        immediate = {
                save_event_target_as = src_planet
                random_planet = {
                        limit = {
                                has_planet_flag = habitat_of@prev
                                has_planet_flag = starborn_farming_habitat
                        }
                        save_event_target_as = target_hab
                        remove_modifier = starborn_farming_planet
                }

                owner = {
                        country_event = {
                                id = starborn.31
                        }
                }
        }
        
}

country_event = {
        id = starborn.31
        is_triggered_only = yes
        title = "starborn.31.name"
        desc = "starborn.31.desc"
        picture = GFX_evt_colony_settlement
        option = {
                name = "starborn.31.option.a"
        }
}


# 40. Remove tomb world savenger when terraformed
planet_event = {
        id = starborn.40
        hide_window = yes
        is_triggered_only = yes

        trigger = {
                solar_system = {
                        any_system_planet = {
                                has_planet_flag = habitat_of@root
                                has_planet_flag = starborn_tomb_scavenging
                        }   
                }
        }

        immediate = {
                save_event_target_as = src_planet
                random_planet = {
                        limit = {
                                has_planet_flag = habitat_of@root
                                has_planet_flag = starborn_tomb_scavenging
                        }
                        save_event_target_as = target_hab
                        remove_planet_flag = starborn_tomb_scavenging
                        remove_deposit = d_starborn_retile_scavenger
                        while = {
                                limit = {
                                        num_districts = {
                                                type = district_starborn_starting_scavenger
                                                value > 0                                                
                                        }
                                }
                                remove_district = district_starborn_starting_scavenger
                                add_district = district_starborn_surface_farming
                        }
                        set_planet_flag = starborn_farming_habitat
                        
                        if = {
                                limit = {
                                        root = {
                                                has_owner = no
                                        }
                                }
                                add_modifier = {
                                        modifier = starborn_farming_planet
                                        days = -1
                                }
                        }
                      
                }
                if = {
                        limit = {
                                has_planet_flag = starborn_origin
                        }
                        planet_event = {
                                id = starborn.70
                        }
                        from = {
                                country_event = {
                                        id = starborn.42
                                }
                        }
                }
                else = {
                        from = {
                                country_event = {
                                        id = starborn.41
                                }
                        }
                }
        }
}

# message when non homeworld has been terraformed - remove scavenger districts
country_event = {
        id = starborn.41
        title = "starborn.41.name"
        desc = "starborn.41.desc"
        is_triggered_only = yes
        picture = GFX_evt_colony_settlement

        option = {
                name = "starborn.41.option.a"
        }
}

# message when homeworld has been terraformed - remove scavenger districts
country_event = {
        id = starborn.42
        title = "starborn.42.name"
        desc = "starborn.42.desc"
        is_triggered_only = yes
        picture = GFX_evt_colony_settlement

        option = {
                name = "starborn.42.option.a"
                add_monthly_resource_mult = {
                        resource = unity
                        value = @tier4unityreward
                        min = @tier4unitymin
                        max = @tier4unitymax
                }
        }
}


# annual poll for city conversion
country_event = {
        id = "starborn.50"
        is_triggered_only = yes
        hide_window = yes

        trigger = {
                has_starborn = yes
                is_regular_empire = yes
                OR = {
                        has_ascension_perk = ap_arcology_project
                        AND = {
                                has_retile = yes
                                has_technology = tech_housing_3
                        }                        	
                }                
                any_owned_planet = {
                        is_planet_class = pc_city
                        NOR = { 
                                has_planet_flag = starborn_citied
                                has_planet_flag = starborn_origin_citied
                        }
                }
        }

        immediate = {
                every_owned_planet = {
                        limit = {
                                is_planet_class = pc_city
                                NOR = {
                                        has_planet_flag = starborn_citied
                                }
                        }
                        planet_event = {
                                id = starborn.51
                        }
                }
        }
}



# 13. Add City world mod when converted
# notification in separate country event for my sanity
planet_event = {
        id = starborn.51
        is_triggered_only = yes
        hide_window = yes
        immediate = {
                set_planet_flag = starborn_citied
                save_event_target_as = src_planet
                random_planet = {
                        limit = {
                                has_planet_flag = habitat_of@root
                        }
                        save_event_target_as = target_hab
                        remove_planet_flag = starborn_tomb_scavenging
                        remove_planet_flag = starborn_farming_habitat
                        remove_modifier = starborn_farming_planet
                        set_planet_flag = commercial_habitat
                        
                        while = {
                                limit = {
                                        has_deposit = d_starborn_retile_scavenger
                                }
                                remove_deposit = d_starborn_retile_scavenger
                        }
                        
                        while = {
                                limit = {
                                        num_districts = {
                                                type = district_starborn_starting_scavenger
                                                value > 0
                                        }
                                }
                                remove_district = district_starborn_starting_scavenger
                                add_district = district_hab_commercial
                        }
                        while = {
                                limit = {
                                        num_districts = {
                                                type = district_starborn_surface_farming
                                                value > 0                                                
                                        }
                                }
                                remove_district = district_starborn_surface_farming
                                add_district = district_hab_commercial
                        }
                        # homeworld needs a different district to avoid overriding vanilla
                        if = {
                                limit = {
                                        has_planet_flag = starborn_orbital_city
                                }
                                while = {
                                        limit = {
                                                num_districts = {
                                                        type = district_hab_commercial
                                                        value > 0                                                
                                                }
                                        }
                                        remove_district = district_hab_commercial
                                        add_district = district_starborn_hab_commercial
                                }
                        }

                        if = {
                                limit = {
                                        has_retile = yes
                                }
                                add_modifier = {
                                        modifier = starborn_pc_city_trade_value_retile
                                        days = -1
                                }
                        }
                        else = {
                                add_modifier = {
                                        modifier = starborn_pc_city_trade_value
                                        days = -1
                                }
                        }
                }
                if = {
                        limit = {
                                has_planet_flag = starborn_origin
                        }
                        planet_event = {
                                id = starborn.70
                        }
                        from = {
                                country_event = {
                                        id = starborn.53
                                }
                        }
                }
                else = {
                        from = {
                                country_event = {
                                        id = starborn.52
                                }
                        }
                }
        }
}


# message when non homeworld has been citied
country_event = {
        id = starborn.52
        title = "starborn.52.name"
        desc = "starborn.52.desc"
        is_triggered_only = yes
        picture = GFX_evt_city_planet

        option = {
                name = "starborn.52.option.a"
        }
}

# message when homeworld has been citied
country_event = {
        id = starborn.53
        title = "starborn.53.name"
        desc = "starborn.53.desc"
        is_triggered_only = yes
        picture = GFX_evt_city_planet

        option = {
                name = "starborn.53.option.a"
                add_monthly_resource_mult = {
                        resource = unity
                        value = @tier5unityreward
                        min = @tier5unitymin
                        max = @tier5unitymax
                }
        }
}



# reward the player for colonising paradise lost
planet_event = {
        id = starborn.60
        hide_window = yes
        is_triggered_only = yes

        trigger = {
                exists = owner
                owner = {
                        has_starborn = yes
                }
                has_planet_flag = starborn_origin
                is_planet_class = pc_nuked
        }

        immediate = {
                set_name = "Paradise Lost"
                save_event_target_as = src_planet
                owner = {
                        country_event = {
                                id = starborn.61
                        }
                }
        }
}

# message for colonising nuked homeworld
country_event = {
        id = starborn.61
        title = "starborn.61.name"
        desc = "starborn.61.desc"
        is_triggered_only = yes
        picture = GFX_evt_city_ruins

        option = {
                name = "starborn.61.option.a"
                add_monthly_resource_mult = {
                        resource = unity
                        value = @tier2unityreward
                        min = @tier2unitymin
                        max = @tier2unitymax
                }
        }
}


# upgrade the oblisk of rememberance
planet_event = {
        id = starborn.70
        hide_window = yes
        is_triggered_only = yes

        trigger = {
                exists = owner
                owner = {
                        has_starborn = yes
                }
                
        }

        immediate = {
                save_event_target_as = src_planet
                if = {
                        limit = {
                                has_building = building_starborn_obelisk_nuked
                        }
                        remove_building = building_starborn_obelisk_nuked
                        add_building = building_starborn_obelisk_restored
                        owner = {
                                country_event = {
                                        id = starborn.71
                                }
                        }
                }
        }
}

# message for upgrading the oblisk
country_event = {
        id = starborn.71
        title = "starborn.71.name"
        desc = "starborn.71.desc"
        is_triggered_only = yes
        picture = GFX_evt_galactic_community

        option = {
                name = EXCELLENT
        }
}



# Starborn orbit dwellers trait
pop_event = {
        id = starborn.80
        hide_window = yes

        is_triggered_only = yes

        immediate = {
                if = {
                        limit = { 
                                has_trait = trait_pc_starborn_habitat_start_preference
                                NOT = { has_trait = trait_starborn_positive }
                                from = { 
                                        OR = { 
                                                is_planet_class = pc_habitat 
                                                is_planet_class = pc_starborn_habitat_start 
                                        }
                                }
                        }
                        modify_species = {
                                species = this
                                add_trait = trait_starborn_positive
                        }
                        if = {
                                limit = { has_trait = trait_starborn_negative_1 }
                                modify_species = {
                                        species = this
                                        remove_trait = trait_starborn_negative_1
                                }
                        }
                        if = {
                                limit = { has_trait = trait_starborn_negative_2 }
                                modify_species = {
                                        species = this
                                        remove_trait = trait_starborn_negative_2
                                }
                        }
                        if = {
                                limit = { has_trait = trait_starborn_negative_3 }
                                modify_species = {
                                        species = this
                                        remove_trait = trait_starborn_negative_3
                                }
                        }
                }
                else_if = {
                        limit = {
                                has_trait = trait_starborn_positive
                                from = {
                                        habitable_structure = no
                                        NOT = { is_planet_class = pc_starborn_habitat_start }
                                }
                        }
                        random_list = {
                                10 = {
                                        modifier = {
                                                factor = 2
                                                planet = {
                                                        or = {
                                                                planet_size > 16
                                                                has_planet_modifier = pm_high_gravity
                                                        }
                                                }
                                        }
                                        modifier = {
                                                factor = 0.5
                                                planet = {
                                                        or = {
                                                                planet_size < 10
                                                                has_planet_modifier = pm_low_gravity
                                                        }
                                                }
                                        }
                                        modify_species = {
                                                species = this
                                                remove_trait = trait_starborn_positive
                                                add_trait = trait_starborn_negative_1
                                        }
                                }
                                5 = { 
                                        modify_species = {
                                                species = this
                                                remove_trait = trait_starborn_positive
                                                add_trait = trait_starborn_negative_2
                                        }
                                }
                                5 = {
                                        modify_species = {
                                                species = this
                                                remove_trait = trait_starborn_positive
                                                add_trait = trait_starborn_negative_3
                                        }
                                }
                        }
                        
                }
        }
}

country_event = {
        id = starborn.90
        hide_window = yes
        is_triggered_only = yes
        immediate = {
                capital_star = {
                        solar_system = {
                                random_system_planet = {
                                        limit = {
                                                is_planet_class = pc_gas_giant
                                        }
                                        add_deposit = d_society_10
                                        add_deposit = d_engineering_10
                                        add_deposit = d_physics_10
                                }
                                
                                random_system_planet = {
                                        limit = {
                                                is_planet_class = pc_asteroid
                                                not = {
                                                        has_planet_flag = has_megastructure
                                                }
                                        }
                                        add_deposit = d_alloys_5
                                }
                                
                                random_system_planet = {
                                        limit = {
                                                is_star = no
                                                has_deposit = no
                                                habitable_structure = no
                                                nor = {
                                                        has_planet_flag = has_megastructure
                                                        is_planet_class = pc_asteroid                                                        
                                                }
                                        }
                                        add_deposit = d_dark_matter_deposit_3
                                        add_deposit = d_zro_deposit_5
                                        add_deposit = d_living_metal_deposit
                                        add_deposit = d_nanites_deposit
                                }

                                random_system_planet = {
                                        limit = {
                                                is_star = no
                                                has_deposit = no
                                                habitable_structure = no
                                                nor = {
                                                        has_planet_flag = has_megastructure
                                                        is_planet_class = pc_asteroid
                                                }
                                        }
                                       change_pc = pc_continental
                                       reroll_planet = yes
                                }

                                random_system_planet = {
                                        limit = {
                                                is_star = no
                                                has_deposit = no
                                                habitable_structure = no
                                                nor = {
                                                        has_planet_flag = has_megastructure
                                                        is_planet_class = pc_asteroid
                                                }
                                        }
                                       change_pc = pc_nuked
                                       reroll_planet = yes
                                }

                                random_system_planet = {
                                        limit = {
                                                is_star = no
                                                has_deposit = no
                                                habitable_structure = no
                                                nor = {
                                                        has_planet_flag = has_megastructure
                                                }
                                        }
                                        add_deposit = d_exotic_gases_5
                                }

                                random_system_planet = {
                                        limit = {
                                                is_star = no
                                                has_deposit = no
                                                habitable_structure = no
                                                nor = {
                                                        has_planet_flag = has_megastructure
                                                }
                                        }
                                        add_deposit = d_rare_crystals_5
                                }

                                random_system_planet = {
                                        limit = {
                                                is_star = no
                                                has_deposit = no
                                                habitable_structure = no
                                                nor = {
                                                        has_planet_flag = has_megastructure
                                                }
                                        }
                                        add_deposit = d_volatile_motes_5
                                }

                                random_system_planet = {
                                        limit = {
                                                is_star = no
                                                has_deposit = no
                                                habitable_structure = no
                                                nor = {
                                                        has_planet_flag = has_megastructure
                                                }
                                        }
                                        add_deposit = d_trade_value_10
                                }
                        }
                }
                country_event = {
                        id = starborn_init.7
                }
        }
}




planet_event = {
        id = starborn.100
        hide_window = yes
        is_triggered_only = yes
        trigger = {
                fromfrom = { 
                        has_starborn_retile = yes
                }
        }
        immediate = {
                if = {
                        limit = {
                                has_planet_flag = starborn_farming_habitat
                        }
                        set_planet_flag = hydroponics_habitat
                }
                if = {
                        limit = {
                                AND = {
                                        NOT = { has_planet_flag = mining_habitat }
                                        NOT = { has_planet_flag = energy_habitat }
                                        NOT = { has_planet_flag = research_habitat }
                                        NOT = { has_planet_flag = commercial_habitat }
                                        NOT = { has_planet_flag = starborn_tomb_scavenging }
                                }
                        }
                        set_planet_flag = hydroponics_habitat
                }
                
                if = {
                        limit = {
                                has_planet_flag = starborn_tomb_scavenging
                        }
                        add_deposit = d_starborn_retile_scavenger
                        change_variable = { which = module_count value = 1 }
                }

                # apply pop density modifier
                planet_event = { id = retile_pop.3000 days = 1 }
        }
}

# Check if starborn starting hab is habitable structure.
country_event = {
        id = starborn.110
        fire_only_once = yes
        hide_window = yes
        mean_time_to_happen = {
                days = 1
        }
        trigger = {
                has_starborn = yes
        }

        immediate = {
                random_planet = {
                        limit = {
                                is_planet_class = pc_starborn_habitat_start
                        }
                        if = {
                                limit = { 
                                        habitable_structure = no
                                }
                                country_event = {
                                        id =  starborn.111
                                }
                        }
                }
        }
}

country_event = {
        id = starborn.111
        is_triggered_only = yes
        title = starborn.111.name
        desc = starborn.111.desc
        picture = GFX_evt_synth_sabotage
        option = {
                name = OK
        }
}
